<html>
  <head><title>Comicify</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
      function comicify(c){
	  var _t = this;
	  _t.draw(c);
      }

      comicify.prototype={
	  draw:function(container){
	      var t = this;
	      t.container = container;
	      var input = $('<input>').val(15);
	      container.append($('<div>').text("First set the distance to a value that sets colors merged, then paste an image to process"));
	      container.append($('<div>').append($('<span>').text("Distance:").width("400px")).append(input))
	      t.srcimg = $('<img>');
	      container.on('paste',function(evt){
		  return(t.handlePaste(evt));
			});
	  },
	  handlePaste : function  (evt) {
	      var t = this;
	      var items = evt.originalEvent.clipboardData.items, paste;
	      for (var i in items){
		  if('file' ==items[i].kind){
		      var fr = new FileReader();
		      fr.onload = function(revt){
			  t.srcimg[0].src = revt.target.result;
			  t.srcimg.load(function(){t.process()});
		      }
		      fr.readAsDataURL(items[i].getAsFile());
		  }
	      }
	  },
	  process:function(){
	      var t = this;
	      var canvas = $('<canvas>');
	      canvas[0].width = t.srcimg[0].width;
	      canvas[0].height= t.srcimg[0].height;
	      var ctx = canvas[0].getContext('2d');
	      ctx.drawImage(t.srcimg[0],0,0);
	      var outImg = $('<img>');
	      outImg[0].src =canvas[0].toDataURL();
	      t.container.append(outImg);
	  },
	  srcimg:0,
	  cnv:0,
	  distance : 0,
	  container : 0,  // container
      } // proto

      function startmeup(){
	  var body = $('body').append($('<h1>').text('Comicify'));
	  var c = new comicify(body);
      }


      $(document).ready(function(){startmeup();});
      
    </script>
  </head>
  <body>
  </body>
</html>
